<!-- Task Detail Component Template -->
<div class="task-detail-container">
  
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading task details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>Error Loading Task</h2>
    <p>{{ errorMessage }}</p>
    <button (click)="goBack()" class="btn btn-primary">Go Back</button>
  </div>

  <!-- Task Details Content -->
  <div *ngIf="!loading && !error && task" class="task-detail-content">
    
    <!-- Header Section -->
    <div class="task-header">
      <button (click)="goBack()" class="btn btn-secondary back-btn">
        <mat-icon>arrow_back</mat-icon>
        Back to Tasks
      </button>
      <div class="task-actions">
        <button 
          *ngIf="!isEditMode" 
          (click)="toggleEditMode()" 
          class="btn btn-primary"
          [disabled]="saving">
          <mat-icon>edit</mat-icon>
          Edit Task
        </button>
        <button 
          *ngIf="isEditMode" 
          (click)="saveTask()" 
          class="btn btn-success"
          [disabled]="!editForm.valid || saving">
          <mat-icon>save</mat-icon>
          {{ saving ? 'Saving...' : 'Save Changes' }}
        </button>
        <button 
          *ngIf="isEditMode" 
          (click)="cancelEdit()" 
          class="btn btn-secondary"
          [disabled]="saving">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>
        <button 
          (click)="deleteTask()" 
          class="btn btn-danger"
          [disabled]="saving">
          <mat-icon>delete</mat-icon>
          Delete Task
        </button>
      </div>
    </div>

    <!-- Task Title and Status -->
    <div class="task-title-section">
      <!-- View Mode -->
      <div *ngIf="!isEditMode">
        <h1 class="task-title">{{ task.title }}</h1>
        <div class="task-status-badge" [ngClass]="getStatusClass(task.status)">
          {{ task.status }}
        </div>
      </div>
      
      <!-- Edit Mode -->
      <div *ngIf="isEditMode" class="edit-form-section">
        <form [formGroup]="editForm" class="edit-form">
          <mat-form-field appearance="outline" class="title-field">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" required>
            <mat-error *ngIf="editForm.get('title')?.hasError('required')">
              Title is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="status-field">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status" required>
              <mat-option value="Pending">Pending</mat-option>
              <mat-option value="InProgress">In Progress</mat-option>
              <mat-option value="Completed">Completed</mat-option>
            </mat-select>
          </mat-form-field>
        </form>
      </div>
    </div>

    <!-- Task Information Grid -->
    <div class="task-info-grid">
      
      <!-- Priority Section -->
      <div class="info-card">
        <h3>Priority</h3>
        <!-- View Mode -->
        <div *ngIf="!isEditMode" class="priority-badge" [ngClass]="getPriorityClass(task.priority)">
          {{ task.priority }}
        </div>
        <!-- Edit Mode -->
        <mat-form-field *ngIf="isEditMode" appearance="outline" class="priority-field">
          <mat-label>Priority</mat-label>
          <mat-select formControlName="priority" required>
            <mat-option value="Low">Low</mat-option>
            <mat-option value="Medium">Medium</mat-option>
            <mat-option value="High">High</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Due Date Section -->
      <div class="info-card">
        <h3>Due Date</h3>
        <!-- View Mode -->
        <div *ngIf="!isEditMode" class="due-date" [ngClass]="{'overdue': isOverdue(task.dueDate)}">
          {{ formatDate(task.dueDate) }}
        </div>
        <small *ngIf="!isEditMode && isOverdue(task.dueDate)" class="overdue-warning">
          ‚ö†Ô∏è This task is overdue!
        </small>
        <!-- Edit Mode -->
        <mat-form-field *ngIf="isEditMode" appearance="outline" class="due-date-field">
          <mat-label>Due Date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dueDate" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="editForm.get('dueDate')?.hasError('required')">
            Due date is required
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Created Date -->
      <div class="info-card">
        <h3>Created</h3>
        <div class="date-info">
          {{ formatDateTime(task.createdAt || '') }}
        </div>
      </div>

      <!-- Last Updated -->
      <div class="info-card">
        <h3>Last Updated</h3>
        <div class="date-info">
          {{ formatDateTime(task.updatedAt || '') }}
        </div>
      </div>

    </div>

    <!-- Description Section -->
    <div class="description-section">
      <h3>Description</h3>
      <!-- View Mode -->
      <div *ngIf="!isEditMode" class="description-content" [ngClass]="{'no-description': !task.description}">
        <span *ngIf="task.description">{{ task.description }}</span>
        <em *ngIf="!task.description">No description provided for this task.</em>
      </div>
      <!-- Edit Mode -->
      <mat-form-field *ngIf="isEditMode" appearance="outline" class="description-field">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" rows="4" placeholder="Enter task description..."></textarea>
      </mat-form-field>
    </div>

    <!-- Task ID (for reference) -->
    <div class="task-id-section">
      <small>Task ID: {{ task.id }}</small>
    </div>

  </div>

  <!-- No Task Found -->
  <div *ngIf="!loading && !error && !task" class="no-task-container">
    <div class="no-task-icon">üìã</div>
    <h2>Task Not Found</h2>
    <p>The task you're looking for doesn't exist or has been removed.</p>
    <button (click)="goBack()" class="btn btn-primary">Go Back to Tasks</button>
  </div>

</div>
